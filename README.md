# Alyne Backend

A Next.js backend API for the Alyne fitness platform with Supabase integration, web scraping capabilities, and real-time features.

## 🚀 Quick Start

```bash
# Install dependencies
yarn install

# Set up environment variables
cp .env.example .env.local
# Edit .env.local with your Supabase credentials

# Run development server
yarn dev

# Build for production
yarn build

# Start production server
yarn start
```

## 📁 Project Structure

```
alyne-backend/
├── app/                    # Next.js App Router
│   ├── api/               # API routes
│   │   ├── auth/          # Authentication endpoints
│   │   ├── conversations/ # Messaging system
│   │   ├── search/        # Search functionality
│   │   ├── studios/       # Studio management
│   │   └── users/         # User management
│   ├── globals.css        # Global styles
│   ├── layout.tsx         # Root layout
│   └── page.tsx           # Home page
├── lib/                    # Utility libraries
│   ├── supabase.ts        # Supabase client
│   ├── supabase-edge.ts   # Edge runtime client
│   ├── notifications.ts   # Notification system
│   └── webScraper.ts     # Web scraping utilities
├── migrations/             # Database migrations
├── next.config.ts          # Next.js + PostCSS + Vercel config
├── package.json            # Dependencies + scripts + ESLint config
├── tsconfig.json           # TypeScript configuration
└── README.md               # This file
```

## ⚙️ Configuration

### Minimal Configuration Files
The repository now uses only the essential configuration files:

- **`next.config.ts`** - Next.js + Vercel + ESLint + TypeScript settings
- **`tsconfig.json`** - TypeScript configuration with Next.js integration  
- **`.eslintrc.json`** - ESLint rules (auto-generated by Next.js)
- **`postcss.config.js`** - PostCSS for Tailwind CSS (required by Next.js)
- **`middleware.ts`** - Authentication middleware (required for API security)

### What Was Consolidated
- ✅ **Vercel config** → Merged into `next.config.ts`
- ✅ **Environment types** → Integrated into `tsconfig.json`
- ✅ **Build artifacts** → Removed (`*.tsbuildinfo`, `package-lock.json`)
- ✅ **Duplicate configs** → Eliminated redundant files

### Key Features
- **Single config file** - Most settings in `next.config.ts`
- **Auto-generated ESLint** - Next.js handles ESLint configuration
- **Built-in PostCSS** - Minimal PostCSS config for Tailwind
- **Vercel integration** - Headers and environment variables in main config
- **Authentication** - Middleware for API route protection

## 🛠️ Scripts

- `yarn dev` - Development server with Turbopack
- `yarn build` - Production build
- `yarn start` - Production server
- `yarn lint` - ESLint checking
- `yarn lint:fix` - ESLint with auto-fix
- `yarn type-check` - TypeScript type checking
- `yarn check` - Full validation (lint + types + build)
- `yarn precommit` - Pre-commit validation

## 🔐 Authentication

Uses Supabase for authentication with middleware protection on all API routes except:
- `/api/auth/*` - Authentication endpoints
- `/api/studios/featured` - Public studio listings
- `/api/search/events` - Public event search

## 🗄️ Database

- Supabase PostgreSQL
- Real-time subscriptions
- Row Level Security (RLS)
- Migrations in `/migrations/`

## 🌐 API Endpoints

### Authentication
- `POST /api/auth/register` - User registration
- `POST /api/auth/login` - User login
- `POST /api/auth/forgot-password` - Password reset request
- `POST /api/auth/reset-password` - Password reset

### Users
- `GET /api/users/me` - Current user profile
- `GET /api/users/[id]` - User profile by ID
- `GET /api/users/[id]/activity` - User activity
- `GET /api/users/[id]/followers` - User followers
- `GET /api/users/[id]/following` - User following

### Studios
- `GET /api/studios` - List studios
- `GET /api/studios/[id]` - Studio details
- `GET /api/studios/featured` - Featured studios
- `GET /api/studios/[id]/classes` - Studio classes

### Messaging
- `GET /api/conversations` - User conversations
- `POST /api/conversations` - Create conversation
- `GET /api/conversations/[id]` - Conversation details
- `POST /api/messages` - Send message
- `GET /api/messages` - Get messages

### Search
- `POST /api/search/members` - Search users
- `GET /api/search/following` - Following users
- `GET /api/search/followers` - Follower users
- `GET /api/search/events` - Search events

## 🚀 Deployment

### Vercel
- Automatic deployments from Git
- Edge runtime support
- Function timeout configuration
- Environment variable management

### Environment Variables
```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Optional
PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD=1
```

## 🔧 Development

### Code Quality
- ESLint with Next.js rules
- TypeScript strict mode
- Pre-commit hooks
- Automated testing pipeline

### Database Migrations
```bash
# Apply migrations
psql -h your_host -U your_user -d your_db -f migrations/001_initial.sql
```

### API Testing
Use tools like Postman or curl to test endpoints:
```bash
# Example: Get current user
curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://your-domain.vercel.app/api/users/me
```

## 📚 Dependencies

### Core
- **Next.js 15** - React framework
- **Supabase** - Backend as a service
- **TypeScript** - Type safety
- **Tailwind CSS** - Styling

### Utilities
- **Zod** - Schema validation
- **Axios** - HTTP client
- **Cheerio** - HTML parsing
- **Puppeteer** - Web scraping

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Run `yarn check`
5. Submit a pull request

## 📄 License

Private project - All rights reserved.
